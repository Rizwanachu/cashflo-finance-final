You are implementing a LOGIN + IDENTITY SYSTEM for Spendory.

This system exists ONLY to:

Identify users

Track Pro subscriptions

Prevent Pro access loss when the app is removed and reinstalled

⚠️ NON-NEGOTIABLE PRINCIPLES:

Spendory remains privacy-first

User financial data NEVER leaves the device

App must continue working offline after login

No transaction, category, budget, or analytics data is ever synced to a server

AUTH METHODS (REQUIRED)

Implement mandatory login on first launch using:

Sign in with Google

Email + OTP (passwordless)

No anonymous usage.
No passwords.

IDENTITY MODEL

On successful login:

Generate a stable userId

Store locally:

user = {
 userId,
 email,
 provider: "google" | "email",
 createdAt,
 lastLoginAt
}


Save user metadata ONLY (not app data)

DATA OWNERSHIP RULES (CRITICAL)

ALL Spendory data stays in localStorage / IndexedDB

Login system NEVER touches:

transactions

categories

accounts

budgets

analytics

Login exists ONLY for:

identity

subscription verification

PRO SUBSCRIPTION CONTINUITY (CORE FIX)

Problem to solve:
Removing the PWA wipes local data → Pro is lost.

Solution:

Pro status is tied to userId, not device

On login:

Fetch subscription status from billing provider

Restore Pro access automatically

Store locally:

proStatus = {
 isPro: true,
 plan,
 validUntil,
 lastVerifiedAt
}


Pro verification:

On login

On app launch (if online)

Cached locally for offline use

OFFLINE BEHAVIOR

If user is logged in once:

App works fully offline

Pro features stay unlocked until expiry

If offline:

Skip verification

Do NOT revoke Pro

EARNINGS & USER COUNT (BUSINESS NEED)

Backend only stores:

userId

email hash

subscription status

plan

payment events

NO app usage data
NO financial data
NO analytics data

Use this backend ONLY to:

Count total users

Count active Pro users

Track revenue

UI REQUIREMENTS

First launch → Login screen (blocking)

Logged-in user sees:

Email

Plan (Free / Pro)

Restore Pro status message if applicable

Clear copy:
“Your data stays on your device. Login only protects your Pro access.”

SECURITY RULES

Tokens are short-lived

Refresh tokens stored securely

Logout clears identity & Pro cache

App data remains unless user deletes it

FINAL RESULT

Users can reinstall Spendory and keep Pro

You can accurately track:

Users

Subscriptions

Revenue

Spendory remains:

Serverless for user data

Offline-first

Privacy-first

Implement this cleanly without modifying backup, restore, analytics, or transaction logic.