You are implementing a BRAND-NEW Analytics Export system for Spendory.

THIS IS EXPORT ONLY.
DO NOT touch restore logic.
DO NOT reuse any old analytics export code.

EXPORT FORMATS:
- CSV
- PDF

DATA SOURCE RULES:
- Read data ONLY from localStorage keys prefixed with `spendory-*`
- Use the already-computed analytics data where available
- If analytics data is missing, compute it from transactions safely
- NEVER mutate localStorage during export

GLOBAL METADATA (must appear in CSV + PDF):
- appName: Spendory
- reportType: Analytics Report
- dateRange: derived from data (min → max)
- generatedAt: local timestamp
- currency
- includesIncome: true/false
- includesExpenses: true/false
- includesTags: true/false

-----------------------------------
ANALYTICS SECTIONS TO EXPORT
-----------------------------------

1) CATEGORY BREAKDOWN (Expenses only)

CSV file: category_breakdown.csv

Headers:
categoryId
categoryName
totalSpent
percentageOfTotal
transactionCount
tags (comma-separated, unique)

Rules:
- Aggregate by categoryId
- If transactions contain tags, include all unique tags per category
- If no tags exist, leave tags column empty

-----------------------------------

2) MONTHLY INCOME VS EXPENSES

CSV file: monthly_income_vs_expenses.csv

Headers:
month (YYYY-MM)
totalIncome
totalExpenses
netAmount

-----------------------------------

3) YEAR-TO-DATE SUMMARY

CSV file: ytd_summary.csv

Headers:
year
totalIncomeYTD
totalExpensesYTD
netYTD

-----------------------------------

4) MONTH-OVER-MONTH CHANGE

CSV file: month_over_month.csv

Headers:
month
income
expenses
net
incomeChangeFromPrevious
expenseChangeFromPrevious
netChangeFromPrevious

-----------------------------------

5) BUDGET PERFORMANCE (if budgets exist)

CSV file: budget_performance.csv

Headers:
categoryId
categoryName
budgetLimit
spent
remaining
status (within/exceeded)
tags (comma-separated, inherited from category or transactions)

Rules:
- If no budgets exist, export EMPTY CSV with headers only

-----------------------------------

CSV EXPORT RULES:
- Every CSV MUST include headers
- Numbers must be raw (no currency symbols)
- Dates must be ISO formatted
- Missing datasets must still export EMPTY CSVs
- CSVs must open correctly in Excel and Google Sheets

-----------------------------------
PDF EXPORT REQUIREMENTS
-----------------------------------

PDF layout order:
1. Report header (metadata block)
2. Category Breakdown
   - Donut chart
   - Table with category, amount, %, tags
3. Monthly Income vs Expenses
   - Line chart
   - Table
4. Year-to-Date Summary
5. Month-over-Month table
6. Budget Performance (if available)
7. Footer:
   - "Generated by Spendory"
   - "All data stored locally on your device"

PDF RULES:
- Theme-neutral (no hardcoded blue or brand colors)
- Must remain readable in grayscale
- Charts must match exported CSV data exactly

-----------------------------------
UI REQUIREMENTS
-----------------------------------

Settings → Analytics:
- Button: "Export Analytics"
- Options: CSV | PDF
- Loading state while exporting
- Success toast with file name
- Error toast with clear reason

-----------------------------------
FINAL VALIDATION CHECKLIST
-----------------------------------

- CSV files open correctly
- PDF matches CSV totals exactly
- Tags appear wherever available
- No localStorage mutations
- No reloads
- No silent failures

Build it clean, boring, and reliable.
